<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>X√¢y d·ª±ng PC (Admin Full Ch·ª©c NƒÉng)</title>
    
    <style>
        /* (To√†n b·ªô CSS chung c·ªßa b·∫°n gi·ªØ nguy√™n, kh√¥ng thay ƒë·ªïi) */
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: #f0f2f5;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 30px;
            min-height: 100vh;
        }
        .container {
            background-color: #ffffff;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            width: 100%;
            max-width: 900px;
            margin-bottom: 30px;
        }
        h1 { text-align: center; color: #1a1a1a; margin-top: 0; font-size: 2em; }
        h2 { text-align: center; color: #333; margin-bottom: 20px; border-bottom: 2px solid #eee; padding-bottom: 10px; }
        h3 {
            margin-top: 30px;
            color: #1a1a1a;
            border-bottom: 1px solid #ccc;
            padding-bottom: 5px;
        }
        p { text-align: center; color: #555; margin-bottom: 30px; font-size: 1.1em; }
        .component { display: flex; align-items: center; margin-bottom: 20px; gap: 15px; }
        .component label { font-weight: 600; color: #333; flex-basis: 30%; min-width: 140px; }
        .component-select { flex-grow: 1; padding: 10px 12px; font-size: 16px; border: 1px solid #ccc; border-radius: 6px; background-color: #fafafa; }
        .component-quantity { width: 75px; padding: 10px; font-size: 16px; border: 1px solid #ccc; border-radius: 6px; text-align: center; box-sizing: border-box; flex-shrink: 0; }
        .summary-table { margin-top: 30px; padding-top: 20px; border-top: 2px solid #eee; }
        .summary-table table { width: 100%; border-collapse: collapse; }
        .summary-table th, .summary-table td { border: 1px solid #ddd; padding: 12px 15px; text-align: left; font-size: 15px; }
        .summary-table th { background-color: #f8f8f8; font-weight: 600; }
        .summary-table td:nth-child(2), .summary-table td:nth-child(3) { text-align: center; }
        .summary-table td:nth-child(4), .summary-table td:nth-child(5) { text-align: right; font-weight: 500; }
        .total { margin-top: 20px; padding-top: 20px; border-top: 2px solid #eee; text-align: right; }
        .total h2 { color: #d90429; font-size: 1.8em; margin: 0; border: none; }
        .action-buttons { display: flex; justify-content: flex-end; gap: 15px; margin-top: 30px; padding-top: 20px; border-top: 2px solid #eee; }
        .btn { padding: 12px 20px; font-size: 16px; font-weight: 600; color: #ffffff; border: none; border-radius: 6px; cursor: pointer; text-transform: uppercase; transition: all 0.2s ease; }
        .btn:hover { opacity: 0.85; transform: translateY(-2px); box-shadow: 0 4px 8px rgba(0,0,0,0.1); }
        .btn-print { background-color: #d90429; } .btn-secondary { background-color: #6c757d; } .btn-admin { background-color: #007bff; } .btn-danger { background-color: #dc3545; }
        .btn-success { background-color: #28a745; }
        .modal-hidden { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgba(0, 0, 0, 0.5); }
        .modal-content { background-color: #fefefe; margin: 5% auto; padding: 25px 30px; border: 1px solid #888; width: 90%; max-width: 900px; border-radius: 10px; box-shadow: 0 5px 15px rgba(0,0,0,0.3); }
        .modal-header { display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #eee; padding-bottom: 15px; }
        .modal-header h2 { margin: 0; color: #333; border: none; }
        .close-btn { color: #aaa; font-size: 28px; font-weight: bold; border: none; background: none; cursor: pointer; }
        .modal-body { padding: 20px 0; }
        .modal-body table { width: 100%; border-collapse: collapse; }
        .modal-body th, .modal-body td { border: 1px solid #ddd; padding: 8px; }
        .modal-body input { width: 100%; padding: 6px; border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box; }
        .modal-body input:disabled { background-color: #f0f0f0; color: #333; border: 1px solid #ddd; }
        .modal-body tfoot td { font-size: 1.1em; color: #d90429; }
        .modal-actions { text-align: right; border-top: 1px solid #eee; padding-top: 20px; margin-top: 20px; }
        #admin-panel { border-top: 4px solid #007bff; }
        .form-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .form-group { display: flex; flex-direction: column; }
        .form-group label { font-weight: 600; color: #333; margin-bottom: 5px; }
        .form-group input, .form-group select { padding: 10px 12px; font-size: 16px; border: 1px solid #ccc; border-radius: 6px; }
        .form-group input:disabled, .form-group select:disabled { background-color: #eee; cursor: not-allowed; }
        .form-actions { grid-column: 1 / -1; display: flex; justify-content: space-between; margin-top: 20px; }
        #admin-edit-panel { border-top: 2px solid #eee; margin-top: 30px; padding-top: 20px; }
        #toggle-admin-btn { position: fixed; bottom: 20px; right: 20px; z-index: 999; box-shadow: 0 4px 10px rgba(0,0,0,0.2); }
    </style>
    </head>
<body>
    
    <div class="container" id="build-area">
        <h1>X√¢y D·ª±ng C·∫•u H√¨nh PC</h1>
        <p>Ch·ªçn linh ki·ªán, s·ªë l∆∞·ª£ng v√† xem t√≥m t·∫Øt c·∫•u h√¨nh c·ªßa b·∫°n.</p>
        
        <div id="selector-area">
            <div class="component"><label for="cpu">CPU (Vi x·ª≠ l√Ω):</label><select id="cpu" class="component-select"></select><input type="number" class="component-quantity" value="1" min="0" max="5"></div>
            <div class="component"><label for="mainboard">Mainboard:</label><select id="mainboard" class="component-select"></select><input type="number" class="component-quantity" value="1" min="0" max="5"></div>
            <div class="component"><label for="ram">RAM:</label><select id="ram" class="component-select"></select><input type="number" class="component-quantity" value="1" min="0" max="10"></div>
            <div class="component"><label for="vga">VGA (Card ƒë·ªì h·ªça):</label><select id="vga" class="component-select"></select><input type="number" class="component-quantity" value="1" min="0" max="5"></div>
            <div class="component"><label for="ssd">·ªî c·ª©ng SSD:</label><select id="ssd" class="component-select"></select><input type="number" class="component-quantity" value="1" min="0" max="10"></div>
            <div class="component"><label for="hdd">·ªî c·ª©ng HDD:</label><select id="hdd" class="component-select"></select><input type="number" class="component-quantity" value="1" min="0" max="10"></div>
            <div class="component"><label for="cooler">T·∫£n nhi·ªát:</label><select id="cooler" class="component-select"></select><input type="number" class="component-quantity" value="1" min="0" max="5"></div>
            <div class="component"><label for="monitor">M√†n h√¨nh:</label><select id="monitor" class="component-select"></select><input type="number" class="component-quantity" value="1" min="0" max="5"></div>
            <div class="component"><label for="psu">PSU (Ngu·ªìn):</label><select id="psu" class="component-select"></select><input type="number" class="component-quantity" value="1" min="0" max="5"></div>
            <div class="component"><label for="case">V·ªè Case:</label><select id="case" class="component-select"></select><input type="number" class="component-quantity" value="1" min="0" max="5"></div>
        </div>
        <div class="summary-table">
            <h2>B·∫£ng T√≥m T·∫Øt C·∫•u H√¨nh</h2>
            <table>
                <thead><tr><th>T√™n Linh Ki·ªán</th><th>B·∫£o H√†nh</th><th>S·ªë L∆∞·ª£ng</th><th>ƒê∆°n Gi√°</th><th>Th√†nh Ti·ªÅn</th></tr></thead>
                <tbody id="summary-tbody"></tbody>
            </table>
        </div>
        <div class="total"><h2>T·ªïng: <span id="total-price">0 VNƒê</span></h2></div>
        <div class="action-buttons"><button id="review-btn" class="btn btn-print">üìù Xem B√°o Gi√°</button></div>
    </div>
    
    <div class="container" id="admin-panel" style="display: none;">
        <h2>Qu·∫£n Tr·ªã D·ªØ Li·ªáu</h2>
        
        <div id="admin-add-panel">
            <h3>1. Th√™m Linh Ki·ªán M·ªõi</h3>
            <form id="admin-add-form" class="form-grid">
                <div class="form-group"><label for="add-type">Lo·∫°i linh ki·ªán:</label><select id="add-type"></select></div>
                <div class="form-group"><label for="add-name">T√™n linh ki·ªán:</label><input type="text" id="add-name" required placeholder="v√≠ d·ª•: Intel Core i5-13400F"></div>
                <div class="form-group"><label for="add-price">ƒê∆°n gi√° (VNƒê):</label><input type="number" id="add-price" required placeholder="v√≠ d·ª•: 5200000"></div>
                <div class="form-group"><label for="add-warranty">B·∫£o h√†nh (th√°ng):</label><input type="text" id="add-warranty" required placeholder="v√≠ d·ª•: 36T"></div>
                <div class="form-actions"><button type="submit" class="btn btn-admin">‚ûï Th√™m Linh Ki·ªán</button><button type="button" id="reset-db-btn" class="btn btn-danger">‚ôªÔ∏è Reset Kho V·ªÅ G·ªëc</button></div>
            </form>
        </div>

        <div id="admin-edit-panel">
            <h3>2. Ch·ªânh S·ª≠a Ho·∫∑c X√≥a Linh Ki·ªán</h3>
            <form id="admin-edit-form" class="form-grid">
                <div class="form-group"><label for="edit-type">1. Ch·ªçn Lo·∫°i Linh Ki·ªán:</label><select id="edit-type"></select></div>
                <div class="form-group"><label for="edit-item">2. Ch·ªçn Linh Ki·ªán C·∫ßn S·ª≠a/X√≥a:</label><select id="edit-item" disabled></select></div>
                <div class="form-group"><label for="edit-name">T√™n m·ªõi:</label><input type="text" id="edit-name" disabled></div>
                <div class="form-group"><label for="edit-price">Gi√° m·ªõi:</label><input type="number" id="edit-price" disabled></div>
                <div class="form-group"><label for="edit-warranty">B·∫£o h√†nh m·ªõi:</label><input type="text" id="edit-warranty" disabled></div>
                <div class="form-actions"><button type="button" id="save-edit-btn" class="btn btn-success" disabled>üíæ L∆∞u Thay ƒê·ªïi</button><button type="button" id="delete-item-btn" class="btn btn-danger" disabled>üóëÔ∏è X√≥a Linh Ki·ªán N√†y</button></div>
            </form>
        </div>
    </div>
    
    <button id="toggle-admin-btn" class="btn btn-admin">üë®‚Äçüíª M·ªü Admin</button>

    <div id="print-preview-modal" class="modal-hidden">
        <div class="modal-content" id="capture-area">
            <div class="modal-header">
                <h2>Ki·ªÉm Tra & Ch·ªânh S·ª≠a C·∫•u H√¨nh</h2>
                <button id="close-modal-btn" class="close-btn">&times;</button>
            </div>
            <div class="modal-body">
                <p>B·∫°n c√≥ th·ªÉ s·ª≠a s·ªë l∆∞·ª£ng, ƒë∆°n gi√°. Th√†nh ti·ªÅn v√† t·ªïng c·ªông s·∫Ω t·ª± ƒë·ªông c·∫≠p nh·∫≠t.</p>
                <table>
                    <thead><tr><th>T√™n Linh Ki·ªán</th><th>B·∫£o H√†nh</th><th>S·ªë L∆∞·ª£ng</th><th>ƒê∆°n Gi√°</th><th>Th√†nh Ti·ªÅn</th></tr></thead>
                    <tbody id="preview-tbody"></tbody>
                    <tfoot><tr><td colspan="4" style="text-align: right; font-weight: bold; font-size: 1.2em;">T·ªîNG C·ªòNG:</td><td id="preview-total" style="text-align: right; font-weight: bold; font-size: 1.2em;">0 VNƒê</td></tr></tfoot>
                </table>
            </div>
            <div class="modal-actions">
                <button id="cancel-print-btn" class="btn btn-secondary">H·ªßy B·ªè</button>
                <button id="view-quote-btn" class="btn btn-print">üìÑ Xem B√°o Gi√°</button>
            </div>
        </div>
    </div>

<script>
document.addEventListener('DOMContentLoaded', () => {

    // (Kho d·ªØ li·ªáu g·ªëc initialDatabase gi·ªØ nguy√™n)
    const initialDatabase = {
        cpu: [ { name: "Intel Core i3-12100F", price: 2490000, warranty: "36T" }, { name: "Intel Core i5-12400F", price: 3890000, warranty: "36T" } ],
        mainboard: [ { name: "MSI PRO H610M-E", price: 1800000, warranty: "36T" } ],
        ram: [ { name: "2x8GB DDR4 3200MHz", price: 1100000, warranty: "36T" } ],
        vga: [ { name: "Kh√¥ng d√πng VGA r·ªùi", price: 0, warranty: "0T" } ],
        ssd: [ { name: "SSD 512GB NVMe", price: 950000, warranty: "36T" } ],
        hdd: [ { name: "HDD 1TB Sata 3", price: 1150000, warranty: "24T" } ],
        cooler: [ { name: "T·∫£n nhi·ªát kh√≠ Stock", price: 0, warranty: "0T" } ],
        monitor: [ { name: "M√†n h√¨nh 24 inch 1080p 75Hz", price: 2500000, warranty: "24T" } ],
        psu: [ { name: "Ngu·ªìn 650W 80 Plus Bronze", price: 1200000, warranty: "36T" } ],
        'case': [ { name: "V·ªè Case Xigmatek (3 Fan)", price: 650000, warranty: "12T" } ]
    };
    
    // (L·∫•y c√°c ph·∫ßn t·ª≠ HTML User gi·ªØ nguy√™n)
    const allComponentDivs = document.querySelectorAll('.component');
    const summaryTbody = document.getElementById('summary-tbody');
    const totalPriceElement = document.getElementById('total-price');
    const currencyFormatter = new Intl.NumberFormat('vi-VN', { style: 'currency', currency: 'VND' });
    
    // (L·∫•y c√°c ph·∫ßn t·ª≠ Modal: ƒê√£ c·∫≠p nh·∫≠t)
    const modal = document.getElementById('print-preview-modal');
    const reviewBtn = document.getElementById('review-btn');
    const closeModalBtn = document.getElementById('close-modal-btn');
    const cancelPrintBtn = document.getElementById('cancel-print-btn');
    const viewQuoteBtn = document.getElementById('view-quote-btn'); // ƒê√£ ƒë·ªïi t√™n
    const previewTbody = document.getElementById('preview-tbody');
    const previewTotalElement = document.getElementById('preview-total');

    // (L·∫•y c√°c ph·∫ßn t·ª≠ Admin gi·ªØ nguy√™n)
    const adminPanel = document.getElementById('admin-panel');
    const toggleAdminBtn = document.getElementById('toggle-admin-btn');
    const resetDbBtn = document.getElementById('reset-db-btn');
    const adminAddForm = document.getElementById('admin-add-form');
    const addTypeSelect = document.getElementById('add-type');
    const editTypeSelect = document.getElementById('edit-type');
    const editItemSelect = document.getElementById('edit-item');
    const editNameInput = document.getElementById('edit-name');
    const editPriceInput = document.getElementById('edit-price');
    const editWarrantyInput = document.getElementById('edit-warranty');
    const saveEditBtn = document.getElementById('save-edit-btn');
    const deleteItemBtn = document.getElementById('delete-item-btn');

    let currentDatabase = {};

    // (H√†m 0.1 -> 0.4: loadDatabase, saveDatabase, resetDatabase, parseCurrency gi·ªØ nguy√™n)
    function loadDatabase() {
        let db = JSON.parse(localStorage.getItem('pcBuilderDatabase'));
        if (!db) { db = initialDatabase; saveDatabase(db); }
        currentDatabase = db;
    }
    function saveDatabase(db) {
        localStorage.setItem('pcBuilderDatabase', JSON.stringify(db));
        currentDatabase = db;
    }
    function resetDatabase() {
        if (confirm("B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a TO√ÄN B·ªò d·ªØ li·ªáu ƒë√£ th√™m v√† quay v·ªÅ kho g·ªëc?")) {
            localStorage.removeItem('pcBuilderDatabase');
            location.reload();
        }
    }
    function parseCurrency(text) {
        if (!text) return 0;
        return parseFloat(text.replace(/[^0-9,-]+/g,"")) || 0;
    }

    // (H√†m 1: populateSelectors gi·ªØ nguy√™n)
    function populateSelectors() {
        const allUserSelects = document.querySelectorAll('.component-select');
        allUserSelects.forEach(sel => sel.innerHTML = '');
        addTypeSelect.innerHTML = '';
        editTypeSelect.innerHTML = '';
        const defaultEditTypeOption = new Option("-- 1. Ch·ªçn Lo·∫°i --", "");
        editTypeSelect.appendChild(defaultEditTypeOption);
        for (const componentType in currentDatabase) {
            const selectElement = document.getElementById(componentType);
            const labelText = selectElement.closest('.component').querySelector('label').textContent.replace(':', '');
            const defaultUserOption = new Option(`-- Ch·ªçn ${labelText} --`, "0");
            defaultUserOption.dataset.price = "0";
            defaultUserOption.dataset.warranty = "0T";
            selectElement.appendChild(defaultUserOption);
            currentDatabase[componentType].forEach(product => {
                const option = new Option(product.name, product.name);
                option.dataset.price = product.price;
                option.dataset.warranty = product.warranty;
                selectElement.appendChild(option);
            });
            const addOption = new Option(labelText, componentType);
            addTypeSelect.appendChild(addOption);
            const editOption = new Option(labelText, componentType);
            editTypeSelect.appendChild(editOption);
        }
    }

    // (H√†m 2: updateBuildSummary gi·ªØ nguy√™n)
    function updateBuildSummary() {
        let totalBill = 0;
        summaryTbody.innerHTML = ''; 
        allComponentDivs.forEach(component => {
            const select = component.querySelector('.component-select');
            if (!select) return;
            const quantityInput = component.querySelector('.component-quantity');
            const selectedOption = select.options[select.selectedIndex];
            const price = parseFloat(selectedOption.dataset.price) || 0;
            const quantity = parseInt(quantityInput.value) || 0;
            if (price > 0 && quantity > 0) {
                const componentName = selectedOption.text;
                const warranty = selectedOption.dataset.warranty || 'N/A';
                const lineTotal = price * quantity;
                totalBill += lineTotal;
                const newRow = document.createElement('tr');
                newRow.innerHTML = `<td>${componentName}</td><td style="text-align: center;">${warranty}</td><td style="text-align: center;">${quantity}</td><td style="text-align: right;">${currencyFormatter.format(price)}</td><td style="text-align: right; font-weight: bold;">${currencyFormatter.format(lineTotal)}</td>`;
                summaryTbody.appendChild(newRow);
            }
        });
        totalPriceElement.textContent = currencyFormatter.format(totalBill);
    }
    
    // (H√†m 3: showPrintPreview (m·ªü modal) gi·ªØ nguy√™n)
    function showPrintPreview() {
        previewTbody.innerHTML = '';
        let currentTotalBill = 0;
        const mainRows = summaryTbody.querySelectorAll('tr');
        if (mainRows.length === 0) { alert("Ch∆∞a c√≥ linh ki·ªán n√†o ƒë∆∞·ª£c ch·ªçn!"); return; }
        mainRows.forEach(row => {
            const cells = row.querySelectorAll('td');
            const name = cells[0].textContent, warranty = cells[1].textContent, quantity = cells[2].textContent, priceText = cells[3].textContent, lineTotalText = cells[4].textContent;
            currentTotalBill += parseCurrency(lineTotalText);
            const newRow = document.createElement('tr');
            newRow.innerHTML = `<td><input type="text" class="edit-name" value="${name}"></td><td><input type="text" class="edit-warranty" value="${warranty}" style="width: 80px; text-align: center;"></td><td><input type="number" class="edit-qty" value="${quantity}" style="width: 70px; text-align: center;"></td><td><input type="text" class="edit-price" value="${priceText}" style="text-align: right;"></td><td><input type="text" class="edit-line-total" value="${lineTotalText}" style="text-align: right; font-weight: bold;" disabled></td>`;
            previewTbody.appendChild(newRow);
            const qtyInput = newRow.querySelector('.edit-qty'), priceInput = newRow.querySelector('.edit-price');
            qtyInput.addEventListener('input', () => updateModalRow(newRow));
            priceInput.addEventListener('input', () => updateModalRow(newRow));
        });
        previewTotalElement.textContent = currencyFormatter.format(currentTotalBill);
        modal.style.display = 'block';
    }
    
    // (H√†m 4, 5, 6: hidePrintPreview, updateModalRow, updateModalTotal gi·ªØ nguy√™n)
    function hidePrintPreview() { modal.style.display = 'none'; }
    function updateModalRow(rowElement) {
        const qtyInput = rowElement.querySelector('.edit-qty'), priceInput = rowElement.querySelector('.edit-price'), lineTotalInput = rowElement.querySelector('.edit-line-total');
        const quantity = parseInt(qtyInput.value) || 0, price = parseCurrency(priceInput.value), lineTotal = quantity * price;
        lineTotalInput.value = currencyFormatter.format(lineTotal);
        updateModalTotal();
    }
    function updateModalTotal() {
        let newGrandTotal = 0;
        previewTbody.querySelectorAll('.edit-line-total').forEach(input => { newGrandTotal += parseCurrency(input.value); });
        previewTotalElement.textContent = currencyFormatter.format(newGrandTotal);
    }

    // ===== H√ÄM 7 (ƒê√É VI·∫æT L·∫†I HO√ÄN TO√ÄN) =====
    // T·∫°o trang b√°o gi√° HTML chuy√™n nghi·ªáp
    function createQuotePage() {
        const quoteRows = previewTbody.querySelectorAll('tr'); // L·∫•y d·ªØ li·ªáu t·ª´ modal
        if (quoteRows.length === 0) {
            alert("Kh√¥ng c√≥ g√¨ ƒë·ªÉ hi·ªÉn th·ªã.");
            return;
        }

        let itemsHTML = ''; // Chu·ªói HTML cho c√°c linh ki·ªán
        let finalTotal = 0;

        quoteRows.forEach(row => {
            const name = row.querySelector('.edit-name').value;
            const warranty = row.querySelector('.edit-warranty').value;
            const quantity = row.querySelector('.edit-qty').value;
            const priceText = row.querySelector('.edit-price').value;
            const lineTotalText = row.querySelector('.edit-line-total').value;
            
            finalTotal += parseCurrency(lineTotalText);

            // ƒê√¢y l√† b·ªë c·ª•c d·∫°ng list (gi·ªëng HOTGEAR)
            itemsHTML += `
                <div class="quote-item">
                    <div class="item-info">
                        <div class="item-name">${name}</div>
                        <div class="item-details">
                            <span>M√£ SP: (ƒêang c·∫≠p nh·∫≠t)</span> |
                            <span>B·∫£o h√†nh: ${warranty}</span> |
                            <span>S·ªë l∆∞·ª£ng: ${quantity}</span>
                        </div>
                    </div>
                    <div class="item-price">
                        ${lineTotalText}
                    </div>
                </div>
            `;
        });

        // == B·∫†N C√ì TH·ªÇ S·ª¨A TH√îNG TIN C·ª¨A H√ÄNG ·ªû ƒê√ÇY ==
        const tenCuaHang = "LOGO C·ª¶A B·∫†N / T√äN C·ª¨A H√ÄNG";
        const diaChi = "ƒê·ªãa ch·ªâ c·ªßa b·∫°n";
        const sdt = "Hotline: 0123.456.789";
        const ghiChu = "Qu√Ω kh√°ch vui l√≤ng ki·ªÉm tra k·ªπ h√†ng h√≥a...";
        // ============================================

        const newWindow = window.open();
        const newPageContent = `
            <!DOCTYPE html>
            <html lang="vi">
            <head>
                <meta charset="UTF-8">
                <title>B√°o Gi√° C·∫•u H√¨nh PC</title>
                <style>
                    body {
                        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
                        background-color: #f4f4f4;
                        margin: 0;
                        padding: 20px;
                    }
                    .quote-container {
                        max-width: 800px;
                        margin: 20px auto;
                        background-color: #fff;
                        border: 1px solid #ddd;
                        box-shadow: 0 4px 10px rgba(0,0,0,0.05);
                    }
                    .quote-header {
                        padding: 30px;
                        text-align: center;
                        border-bottom: 1px dashed #ccc;
                    }
                    .quote-header h1 {
                        font-size: 2em;
                        color: #d90429;
                        margin: 0 0 10px 0;
                    }
                    .quote-header p {
                        margin: 2px 0;
                        color: #333;
                    }
                    .quote-list {
                        padding: 20px 30px;
                    }
                    .quote-item {
                        display: flex;
                        justify-content: space-between;
                        align-items: flex-start;
                        padding: 20px 0;
                        border-bottom: 1px solid #eee;
                    }
                    .quote-item:last-child {
                        border-bottom: none;
                    }
                    .item-info {
                        flex-basis: 70%;
                    }
                    .item-name {
                        font-size: 1.1em;
                        font-weight: 600;
                        color: #000;
                    }
                    .item-details {
                        font-size: 0.9em;
                        color: #555;
                        margin-top: 5px;
                    }
                    .item-price {
                        flex-basis: 30%;
                        text-align: right;
                        font-size: 1.1em;
                        font-weight: 600;
                        color: #d90429;
                    }
                    .quote-footer {
                        padding: 30px;
                        background-color: #f8f8f8;
                    }
                    .total-summary {
                        display: flex;
                        justify-content: flex-end;
                        font-size: 1.5em;
                        font-weight: bold;
                        color: #d90429;
                        border-bottom: 1px solid #ddd;
                        padding-bottom: 20px;
                        margin-bottom: 20px;
                    }
                    .total-summary span {
                        margin-left: 20px;
                    }
                    .notes {
                        font-size: 0.85em;
                        color: #666;
                        white-space: pre-wrap; /* Gi·ªØ nguy√™n ƒë·ªãnh d·∫°ng xu·ªëng d√≤ng */
                    }
                    .print-btn {
                        display: block;
                        width: 200px;
                        margin: 20px auto 0 auto;
                        padding: 12px;
                        background-color: #d90429;
                        color: #fff;
                        border: none;
                        border-radius: 6px;
                        font-size: 1em;
                        font-weight: 600;
                        text-align: center;
                        cursor: pointer;
                    }
                    @media print {
                        body { background-color: #fff; padding: 0; }
                        .quote-container { margin: 0; border: none; box-shadow: none; }
                        .print-btn { display: none; }
                    }
                </style>
            </head>
            <body>
                <div class="quote-container">
                    <div class="quote-header">
                        <h1>${tenCuaHang}</h1>
                        <p>${diaChi}</p>
                        <p>${sdt}</p>
                    </div>
                    <div class="quote-list">
                        ${itemsHTML}
                    </div>
                    <div class="quote-footer">
                        <div class="total-summary">
                            <span>T·ªïng chi ph√≠:</span>
                            <span>${currencyFormatter.format(finalTotal)}</span>
                        </div>
                        <div class="notes">
                            <strong>Qu√Ω kh√°ch l∆∞u √Ω:</strong>
                            ${ghiChu}
                        </div>
                    </div>
                </div>
                <button class="print-btn" onclick="window.print()">üñ®Ô∏è In B√°o Gi√°</button>
            </body>
            </html>
        `;
        
        newWindow.document.write(newPageContent);
        newWindow.document.close();
        hidePrintPreview();
    }
    // ===== H·∫æT H√ÄM 7 =====


    // (H√†m 8 -> 13: To√†n b·ªô code Admin gi·ªØ nguy√™n)
    function handleAdminAdd(event) {
        event.preventDefault();
        const type = document.getElementById('add-type').value, name = document.getElementById('add-name').value, price = parseFloat(document.getElementById('add-price').value), warranty = document.getElementById('add-warranty').value;
        if (!name || isNaN(price) || !warranty || !type) { alert('Vui l√≤ng ƒëi·ªÅn ƒë·∫ßy ƒë·ªß v√† ƒë√∫ng ƒë·ªãnh d·∫°ng th√¥ng tin.'); return; }
        const newComponent = { name, price, warranty };
        currentDatabase[type].push(newComponent);
        saveDatabase(currentDatabase);
        alert(`ƒê√£ th√™m "${name}" v√†o danh m·ª•c!`);
        adminAddForm.reset();
        populateSelectors();
        updateBuildSummary();
    }
    function populateEditItems() {
        const type = editTypeSelect.value;
        editItemSelect.innerHTML = ''; resetEditForm();
        if (!type) { editItemSelect.disabled = true; return; }
        editItemSelect.disabled = false;
        editItemSelect.appendChild(new Option("-- 2. Ch·ªçn Linh Ki·ªán --", ""));
        currentDatabase[type].forEach((item, index) => {
            editItemSelect.appendChild(new Option(item.name, index));
        });
    }
    function loadItemToEdit() {
        const type = editTypeSelect.value, index = editItemSelect.value;
        if (index === "") { resetEditForm(); return; }
        const item = currentDatabase[type][index];
        editNameInput.value = item.name;
        editPriceInput.value = item.price;
        editWarrantyInput.value = item.warranty;
        editNameInput.disabled = false; editPriceInput.disabled = false; editWarrantyInput.disabled = false;
        saveEditBtn.disabled = false; deleteItemBtn.disabled = false;
    }
    function resetEditForm() {
        editNameInput.value = ''; editPriceInput.value = ''; editWarrantyInput.value = '';
        editNameInput.disabled = true; editPriceInput.disabled = true; editWarrantyInput.disabled = true;
        saveEditBtn.disabled = true; deleteItemBtn.disabled = true;
    }
    function handleSaveEdit() {
        const type = editTypeSelect.value, index = editItemSelect.value;
        const newName = editNameInput.value, newPrice = parseFloat(editPriceInput.value), newWarranty = editWarrantyInput.value;
        if (!newName || isNaN(newPrice) || !newWarranty) { alert("Vui l√≤ng kh√¥ng ƒë·ªÉ tr·ªëng th√¥ng tin khi l∆∞u!"); return; }
        currentDatabase[type][index] = { name: newName, price: newPrice, warranty: newWarranty };
        saveDatabase(currentDatabase);
        alert("ƒê√£ c·∫≠p nh·∫≠t linh ki·ªán th√†nh c√¥ng!");
        populateSelectors(); updateBuildSummary();
        resetEditForm(); editItemSelect.innerHTML = ''; editItemSelect.disabled = true; editTypeSelect.value = '';
    }
    function handleDeleteItem() {
        const type = editTypeSelect.value, index = editItemSelect.value;
        const item = currentDatabase[type][index];
        if (!confirm(`B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën X√ìA vƒ©nh vi·ªÖn linh ki·ªán:\n\n${item.name}\n\nThao t√°c n√†y kh√¥ng th·ªÉ ho√†n t√°c!`)) { return; }
        currentDatabase[type].splice(index, 1);
        saveDatabase(currentDatabase);
        alert("ƒê√£ X√ìA linh ki·ªán th√†nh c√¥ng!");
        populateSelectors(); updateBuildSummary();
        resetEditForm(); editItemSelect.innerHTML = ''; editItemSelect.disabled = true; editTypeSelect.value = '';
    }
    
    // --- G·∫ÆN S·ª∞ KI·ªÜN (ƒê√£ c·∫≠p nh·∫≠t) ---
    allComponentDivs.forEach(component => {
        const select = component.querySelector('.component-select');
        const quantityInput = component.querySelector('.component-quantity');
        if (select) select.addEventListener('change', updateBuildSummary);
        if (quantityInput) quantityInput.addEventListener('input', updateBuildSummary);
    });
    reviewBtn.addEventListener('click', showPrintPreview);
    closeModalBtn.addEventListener('click', hidePrintPreview);
    cancelPrintBtn.addEventListener('click', hidePrintPreview);
    viewQuoteBtn.addEventListener('click', createQuotePage); // ƒê√£ c·∫≠p nh·∫≠t
    window.onclick = function(event) { if (event.target == modal) hidePrintPreview(); }
    toggleAdminBtn.addEventListener('click', () => {
        if (adminPanel.style.display === 'none') {
            adminPanel.style.display = 'block';
            toggleAdminBtn.textContent = '·∫®n Admin';
        } else {
            adminPanel.style.display = 'none';
            toggleAdminBtn.textContent = 'üë®‚Äçüíª M·ªü Admin';
        }
    });
    resetDbBtn.addEventListener('click', resetDatabase);
    adminAddForm.addEventListener('submit', handleAdminAdd);
    editTypeSelect.addEventListener('change', populateEditItems);
    editItemSelect.addEventListener('change', loadItemToEdit);
    saveEditBtn.addEventListener('click', handleSaveEdit);
    deleteItemBtn.addEventListener('click', handleDeleteItem);

    // --- KH·ªûI CH·∫†Y L·∫¶N ƒê·∫¶U ---
    loadDatabase();
    populateSelectors();
    updateBuildSummary();

});
</script>
</body>
</html>
